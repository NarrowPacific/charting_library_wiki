<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Charting Library</title>
    <meta name="description" content="TradingView 中文文档 教程">
    
    
    <link rel="preload" href="/charting_library_wiki/assets/css/0.styles.54154195.css" as="style"><link rel="preload" href="/charting_library_wiki/assets/js/app.e5b750fa.js" as="script"><link rel="preload" href="/charting_library_wiki/assets/js/63.ff9aea40.js" as="script"><link rel="prefetch" href="/charting_library_wiki/assets/js/45.77fdc049.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/2.cda51ec0.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/3.9a9210e8.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/4.3025f96f.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/5.2e481db8.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/6.692643df.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/7.d6c7c61a.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/8.ff0f9bbb.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/9.929a30eb.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/10.b9ac493c.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/11.67531abf.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/12.95004755.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/13.5f8b090e.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/14.61d2b640.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/15.7019d5c6.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/16.f84bac21.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/17.33bbeaad.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/18.faed2cc9.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/19.eabedd50.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/20.ec41bf98.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/21.e3cda3cb.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/22.75f47b08.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/23.9caf12e7.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/24.9cb52b13.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/25.1ee74391.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/26.23e99a27.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/27.96114175.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/28.c39e9894.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/29.e65ce808.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/30.26d6e58a.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/31.1309fa0e.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/32.f140b54d.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/33.ab7de8c2.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/34.497847f4.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/35.ff0d5d4e.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/36.510643a4.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/37.ea794330.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/38.c805a15f.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/39.dcd0c595.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/40.048441b9.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/41.e8f5ac87.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/42.80345ee9.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/43.810157de.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/44.ee1eb15d.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/46.f3975c58.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/47.e2ed9389.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/48.aa18db6f.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/49.6517b828.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/50.aa45c418.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/51.34038e3a.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/52.d1e1248d.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/53.15f51e33.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/54.b3f35d36.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/55.b3a53b32.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/56.18e47f02.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/57.7107fce6.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/58.fde0151b.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/59.d1cf9754.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/60.79173131.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/61.5e3a4ac2.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/62.e4e6e728.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/64.4f66dc8f.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/65.3b5a4286.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/66.a6f5bbdf.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/67.aff444b7.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/68.c79aa96f.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/69.2f04baac.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/70.b0d52396.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/71.148f19aa.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/72.b9e446e2.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/73.ef903171.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/74.d343d04d.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/75.19ae215d.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/76.51b0e0e4.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/77.6279f2f3.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/78.b96dc129.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/79.039f3470.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/80.f6138705.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/81.cce9bb97.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/82.f6415b45.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/83.d375e2c5.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/84.a50f5549.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/85.de85aa80.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/86.9f650c9e.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/87.d9b6ad2a.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/88.a371aca2.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/89.072874a9.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/90.fababa10.js"><link rel="prefetch" href="/charting_library_wiki/assets/js/91.cd19e4f3.js">
    <link rel="stylesheet" href="/charting_library_wiki/assets/css/0.styles.54154195.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/charting_library_wiki/zh/" class="home-link router-link-active"><!----> <span class="site-name">Charting Library</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/charting_library_wiki/wiki/JS-Api.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/charting_library_wiki/zh/wiki/JS-Api.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/charting_library_wiki/wiki/JS-Api.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/charting_library_wiki/zh/wiki/JS-Api.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/charting_library_wiki/zh/wiki/Home.html" class="sidebar-link">Charting Library 是什么</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>现在开始</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/charting_library_wiki/zh/wiki/Package-Content.html" class="sidebar-link">文件包内容</a></li><li><a href="/charting_library_wiki/zh/wiki/Running-Your-Charting-Library.html" class="sidebar-link">运行图表库</a></li><li><a href="/charting_library_wiki/zh/wiki/Best-Practices.html" class="sidebar-link">最佳实践</a></li><li><a href="/charting_library_wiki/zh/wiki/Frequently-Asked-Questions.html" class="sidebar-link">常见问题</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>绑定数据</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/charting_library_wiki/zh/wiki/How-To-Connect-My-Data.html" class="sidebar-link">如何连接我的数据</a></li><li><a href="/charting_library_wiki/zh/wiki/JS-Api.html" class="active sidebar-link">JS Api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/charting_library_wiki/zh/wiki/JS-Api.html#methods" class="sidebar-link">Methods</a></li><li class="sidebar-sub-header"><a href="/charting_library_wiki/zh/wiki/JS-Api.html#trading-terminal-specific" class="sidebar-link">Trading Terminal specific</a></li></ul></li><li><a href="/charting_library_wiki/zh/wiki/UDF.html" class="sidebar-link">UDF</a></li><li><a href="/charting_library_wiki/zh/wiki/Symbology.html" class="sidebar-link">Symbology</a></li><li><a href="/charting_library_wiki/zh/wiki/Trading-Sessions.html" class="sidebar-link">Trading Sessions</a></li><li><a href="/charting_library_wiki/zh/wiki/Quotes.html" class="sidebar-link">Quotes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>图表定制</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/charting_library_wiki/zh/wiki/Customization-Overview.html" class="sidebar-link">Customization Overview</a></li><li><a href="/charting_library_wiki/zh/wiki/Widget-Constructor.html" class="sidebar-link">a. Widget Constructor</a></li><li><a href="/charting_library_wiki/zh/wiki/Widget-Methods.html" class="sidebar-link">b. Widget Methods</a></li><li><a href="/charting_library_wiki/zh/wiki/Chart-Methods.html" class="sidebar-link">c. Chart Methods</a></li><li><a href="/charting_library_wiki/zh/wiki/Featuresets.html" class="sidebar-link">d. Featuresets</a></li><li><a href="/charting_library_wiki/zh/wiki/Customization-Overview.html#customization-done-through-data-stream" class="sidebar-link">服务器端定制</a></li><li><a href="/charting_library_wiki/zh/wiki/Customization-Use-Cases.html" class="sidebar-link">定制用例</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Trading Terminal</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/charting_library_wiki/wiki/Trading-Terminal.html" class="sidebar-link">1. Brief Intro</a></li><li><a href="/charting_library_wiki/wiki/Broker-API.html" class="sidebar-link">2. Broker API</a></li><li><a href="/charting_library_wiki/wiki/Trading-Host.html" class="sidebar-link">3. Trading Host</a></li><li><a href="/charting_library_wiki/wiki/Account-Manager.html" class="sidebar-link">4. Account Manager</a></li><li><a href="/charting_library_wiki/wiki/Trading-Objects-and-Constants.html" class="sidebar-link"> 5.Trading Objects and Constants</a></li><li><a href="/charting_library_wiki/wiki/Saving-and-Loading-Charts.html" class="sidebar-link">Saving/Loading Charts</a></li><li><a href="/charting_library_wiki/wiki/Creating-Custom-Studies.html" class="sidebar-link">Creating Custom Studies</a></li><li><a href="/charting_library_wiki/wiki/Breaking-Changes.html" class="sidebar-link">Breaking Changes In Version</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p><strong>What is JS API?</strong>: A set of JS methods (specific public interface).</p> <p><strong>Which steps should I follow to start using it?</strong>: You should create a JS object that will receive data by some way and respond to Charting Library requests.</p> <p>Data caching (history &amp; symbol info) is implemented in the Charting Library.</p> <p>When you create an object that implements the described interface simply pass it to Library widget constructor through <a href="Widget-Constructor#datafeed"><code>datafeed</code> argument</a>.</p> <h2 id="methods"><a href="#methods" aria-hidden="true" class="header-anchor">#</a> Methods</h2> <ol><li><a href="#onreadycallback">onReady</a></li> <li><a href="#searchsymbolsuserinput-exchange-symboltype-onresultreadycallback">searchSymbols</a></li> <li><a href="#resolvesymbolsymbolname-onsymbolresolvedcallback-onresolveerrorcallback">resolveSymbol</a></li> <li><a href="#getbarssymbolinfo-resolution-from-to-onhistorycallback-onerrorcallback-firstdatarequest">getBars</a></li> <li><a href="#subscribebarssymbolinfo-resolution-onrealtimecallback-subscriberuid-onresetcacheneededcallback">subscribeBars</a></li> <li><a href="#unsubscribebarssubscriberuid">unsubscribeBars</a></li> <li><a href="#calculatehistorydepthresolution-resolutionback-intervalback">calculateHistoryDepth</a></li> <li><a href="#getmarkssymbolinfo-from-to-ondatacallback-resolution">getMarks</a></li> <li><a href="#gettimescalemarkssymbolinfo-from-to-ondatacallback-resolution">getTimescaleMarks</a></li> <li><a href="#getservertimecallback">getServerTime</a></li></ol> <p>💹 <a href="Trading-Terminal">Trading Terminal</a> specific:</p> <ol><li><a href="#getquotessymbols-ondatacallback-onerrorcallback">getQuotes</a></li> <li><a href="#subscribequotessymbols-fastsymbols-onrealtimecallback-listenerguid">subscribeQuotes</a></li> <li><a href="#unsubscribequoteslistenerguid">unsubscribeQuotes</a></li> <li><a href="#subscribedepthsymbolinfo-callback-string">subscribeDepth</a></li> <li><a href="#unsubscribedepthsubscriberuid">unsubscribeDepth</a></li></ol> <h3 id="onready-callback"><a href="#onready-callback" aria-hidden="true" class="header-anchor">#</a> onReady(callback)</h3> <ol><li><code>callback</code>: function(configurationData)
<ol><li><code>configurationData</code>: object (see below)</li></ol></li></ol> <p>This call is intended to provide the object filled with the configuration data.
This data partially affects the chart behavior and is called <a href="Customization-Overview#customization-done-through-data-stream">server-side customization</a>.
Charting Library assumes that you will call the callback function and pass your datafeed <code>configurationData</code> as an argument.
Configuration data is an object; for now, the following properties are supported:</p> <h4 id="exchanges"><a href="#exchanges" aria-hidden="true" class="header-anchor">#</a> exchanges</h4> <p>An array of exchange descriptors. Exchange descriptor is an object <code>{value, name, desc}</code>. <code>value</code> will be passed as <code>exchange</code> argument to <a href="#searchsymbolsuserinput-exchange-symboltype-onresultreadycallback">searchSymbols</a>.</p> <p><code>exchanges = []</code>  leads to the absence of the exchanges filter in Symbol Search list. Use <code>value = &quot;&quot;</code> if you wish to include all exchanges.</p> <h4 id="symbols-types"><a href="#symbols-types" aria-hidden="true" class="header-anchor">#</a> symbols_types</h4> <p>An array of filter descriptors. Filter descriptor is an object <code>{name, value}</code>. <code>value</code> will be passed as <code>symbolType</code> argument to <a href="#searchsymbolsuserinput-exchange-symboltype-onresultreadycallback">searchSymbols</a>.</p> <p><code>symbolsTypes = []</code>  leads to the absence of filter types in Symbol Search list. Use <code>value = &quot;&quot;</code> if you wish to include all filter types.</p> <h4 id="supported-resolutions"><a href="#supported-resolutions" aria-hidden="true" class="header-anchor">#</a> supported_resolutions</h4> <p>An array of supported resolutions. Resolution must be a string. Format is described in another <a href="Resolution">article</a>.</p> <p><code>supported_resolutions = undefined</code> or <code>supported_resolutions = []</code> leads to resolution widget including the default content.</p> <p>Example: <code>[&quot;1&quot;, &quot;15&quot;, &quot;240&quot;, &quot;D&quot;, &quot;6M&quot;]</code> will give you &quot;1 minute, 15 minutes, 4 hours, 1 day, 6 months&quot; in resolution widget.</p> <h4 id="supports-marks"><a href="#supports-marks" aria-hidden="true" class="header-anchor">#</a> supports_marks</h4> <p>Boolean showing whether your datafeed supports marks on bars or not.</p> <h4 id="supports-timescale-marks"><a href="#supports-timescale-marks" aria-hidden="true" class="header-anchor">#</a> supports_timescale_marks</h4> <p>Boolean showing whether your datafeed supports timescale marks or not.</p> <h4 id="supports-time"><a href="#supports-time" aria-hidden="true" class="header-anchor">#</a> supports_time</h4> <p>Set this one to <code>true</code> if your datafeed provides server time (unix time). It is used to adjust Countdown on the Price scale.</p> <h4 id="futures-regex"><a href="#futures-regex" aria-hidden="true" class="header-anchor">#</a> futures_regex</h4> <p>Set it if you want to group futures in the symbol search. This REGEX should divide an instrument name into 2 parts: a root and an expiration.</p> <p>Sample regex: : <code>/^(.+)([12]!|[FGHJKMNQUVXZ]\d{1,2})$/</code>. It will be applied to the instruments with <code>futures</code> as a <code>type</code>.</p> <h3 id="searchsymbols-userinput-exchange-symboltype-onresultreadycallback"><a href="#searchsymbols-userinput-exchange-symboltype-onresultreadycallback" aria-hidden="true" class="header-anchor">#</a> searchSymbols(userInput, exchange, symbolType, onResultReadyCallback)</h3> <ol><li><code>userInput</code>: string. It is text entered by user in the symbol search field.</li> <li><code>exchange</code>: string. The requested exchange (chosen by user). Empty value means no filter was specified.</li> <li><code>symbolType</code>: string. The requested symbol type: <code>index</code>, <code>stock</code>, <code>forex</code>, etc (chosen by user).
Empty value means no filter was specified.</li> <li><code>onResultReadyCallback</code>: function(result)
<ol><li><code>result</code>: array (see below)</li></ol></li></ol> <p>This call is intended to provide the list of symbols that match the user's search query. <code>result</code> is expected to look like the following:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;symbol&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;short symbol name&gt;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;full_name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;full symbol name&gt;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// e.g. BTCE:BTCUSD</span>
        <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;symbol description&gt;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;exchange&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;symbol exchange name&gt;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ticker&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;symbol ticker name, optional&gt;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;stock&quot;</span> <span class="token comment">// or &quot;futures&quot; or &quot;bitcoin&quot; or &quot;forex&quot; or &quot;index&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//    .....</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>If no symbols are found, then callback should be called with an empty array. See more details about <code>ticker</code> value <a href="Symbology#ticker">here</a></p> <h3 id="resolvesymbol-symbolname-onsymbolresolvedcallback-onresolveerrorcallback"><a href="#resolvesymbol-symbolname-onsymbolresolvedcallback-onresolveerrorcallback" aria-hidden="true" class="header-anchor">#</a> resolveSymbol(symbolName, onSymbolResolvedCallback, onResolveErrorCallback)</h3> <ol><li><code>symbolName</code>: string. Symbol name or <code>ticker</code> if provided.</li> <li><code>onSymbolResolvedCallback</code>: function(<a href="Symbology#symbolinfo-structure">SymbolInfo</a>)</li> <li><code>onResolveErrorCallback</code>: function(reason)</li></ol> <p>Charting Library will call this function when it needs to get <a href="Symbology#symbolinfo-structure">SymbolInfo</a> by symbol name.</p> <h3 id="getbars-symbolinfo-resolution-from-to-onhistorycallback-onerrorcallback-firstdatarequest"><a href="#getbars-symbolinfo-resolution-from-to-onhistorycallback-onerrorcallback-firstdatarequest" aria-hidden="true" class="header-anchor">#</a> getBars(symbolInfo, resolution, from, to, onHistoryCallback, onErrorCallback, firstDataRequest)</h3> <ol><li><code>symbolInfo</code>: <a href="Symbology#symbolinfo-structure">SymbolInfo</a> object</li> <li><code>resolution</code>: string</li> <li><code>from</code>: unix timestamp, leftmost required bar time</li> <li><code>to</code>: unix timestamp, rightmost required bar time</li> <li><code>onHistoryCallback</code>: function(array of <code>bar</code>s, <code>meta</code> = <code>{ noData = false }</code>)
<ol><li><code>bar</code>: object <code>{time, close, open, high, low, volume}</code></li> <li><code>meta</code>: object <code>{noData = true | false, nextTime - unix time}</code></li></ol></li> <li><code>onErrorCallback</code>: function(reason)</li> <li><code>firstDataRequest</code>: boolean to identify the first call of this method for the particular symbol resolution.
When it is set to <code>true</code> you can ignore <code>to</code> (which depends on browser's <code>Date.now()</code>) and return bars up to the latest bar.</li></ol> <p>This function is called when the chart needs a history fragment defined by dates range.</p> <p>The charting library assumes <code>onHistoryCallback</code> to be called <strong>just once</strong>.</p> <p><strong>Important</strong>: <code>nextTime</code> is a time of the next bar in the history. It should be set if the requested period represents a gap in the data. Hence there is available data prior to the requested period.</p> <p><strong>Important</strong>: <code>noData</code> should be set if there is no data in the requested period.</p> <p><strong>Remark</strong>: <code>bar.time</code> is expected to be the amount of milliseconds since Unix epoch start in <strong>UTC</strong> timezone.</p> <p><strong>Remark</strong>: <code>bar.time</code> for daily bars is expected to be a trading day (not session start day) at 00:00 UTC.
Charting Library adjusts time according to <a href="Symbology#session">Session</a> from SymbolInfo</p> <p><strong>Remark</strong>: <code>bar.time</code> for monthly bars is the first trading day of the month without the time part</p> <h3 id="subscribebars-symbolinfo-resolution-onrealtimecallback-subscriberuid-onresetcacheneededcallback"><a href="#subscribebars-symbolinfo-resolution-onrealtimecallback-subscriberuid-onresetcacheneededcallback" aria-hidden="true" class="header-anchor">#</a> subscribeBars(symbolInfo, resolution, onRealtimeCallback, subscriberUID, onResetCacheNeededCallback)</h3> <ol><li><code>symbolInfo</code>: <a href="Symbology#symbolinfo-structure">SymbolInfo</a> object</li> <li><code>resolution</code>: string</li> <li><code>onRealtimeCallback</code>: function(bar)
<ol><li><code>bar</code>: object <code>{time, close, open, high, low, volume}</code></li></ol></li> <li><code>subscriberUID</code>: object</li> <li><code>onResetCacheNeededCallback</code> <em>(since version 1.7)</em>: function() to be executed when bar data has changed</li></ol> <p>Charting Library calls this function when it wants to receive real-time updates for a symbol. The Library assumes that you will call <code>onRealtimeCallback</code> every time you want to update the most recent bar or to add a new one.</p> <p><strong>Remark</strong>: When you call <code>onRealtimeCallback</code> with bar having time equal to the most recent bar's time then the entire last bar is replaced with the <code>bar</code> object you've passed into the call.</p> <p>Example:</p> <ol><li>The most recent bar is <code>{1419411578413, 10, 12, 9, 11}</code></li> <li>You call <code>onRealtimeCallback({1419411578413, 10, 14, 9, 14})</code></li> <li>Library finds out that the bar with the time <code>1419411578413</code> already exists and is the most recent one</li> <li>Library replaces the entire bar making the most recent bar <code>{1419411578413, 10, 14, 9, 14}</code></li></ol> <p><strong>Remark 2</strong>: Is it possible either to update the most recent bar or to add a new one with <code>onRealtimeCallback</code>.
You'll get an error if you call this function when trying to update a historical bar.</p> <p><strong>Remark 3</strong>: There is no way to change historical bars once they've been received by the chart currently.</p> <h3 id="unsubscribebars-subscriberuid"><a href="#unsubscribebars-subscriberuid" aria-hidden="true" class="header-anchor">#</a> unsubscribeBars(subscriberUID)</h3> <ol><li><code>subscriberUID</code>: object</li></ol> <p>Charting Library calls this function when it doesn't want to receive updates for this subscriber any more. <code>subscriberUID</code> will be the same object that Library passed to <code>subscribeBars</code> before.</p> <h3 id="calculatehistorydepth-resolution-resolutionback-intervalback"><a href="#calculatehistorydepth-resolution-resolutionback-intervalback" aria-hidden="true" class="header-anchor">#</a> calculateHistoryDepth(resolution, resolutionBack, intervalBack)</h3> <p><em>Optional.</em></p> <ol><li><code>resolution</code>: requested symbol resolution</li> <li><code>resolutionBack</code>: time period types. Supported values are: <code>D</code> | <code>M</code></li> <li><code>intervalBack</code>: amount of <code>resolutionBack</code> periods that the Charting Library is going to request</li></ol> <p>Charting Library calls this function when it is going to request some historical data to give you an ability to override the amount of bars requested.</p> <p>It passes some arguments so that you are aware of the amount of bars it's going to get. Here are some examples:</p> <ul><li><code>calculateHistoryDepth(&quot;D&quot;, &quot;M&quot;, 12)</code> called: the Library is going to request 12 months of daily bars</li> <li><code>calculateHistoryDepth(&quot;60&quot;, &quot;D&quot;, 15)</code> called: the Library is going to request 15 days of hourly bars</li></ul> <p>This function should return <code>undefined</code> if you do not wish to override anything.
If you do, it should return an object <code>{resolutionBack, intervalBack}</code>.</p> <p>Example:</p> <p>Let's assume that the implementation is as follows</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Datafeed<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">calculateHistoryDepth</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolution<span class="token punctuation">,</span> resolutionBack<span class="token punctuation">,</span> intervalBack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>resolution <span class="token operator">===</span> <span class="token string">&quot;1D&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            resolutionBack<span class="token punctuation">:</span> <span class="token string">'M'</span><span class="token punctuation">,</span>
            intervalBack<span class="token punctuation">:</span> <span class="token number">6</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When the Charting Library requests the data for <code>1D</code> resolution, the history will be 6 months deep.
In all other cases the history depth will have the default value.</p> <h3 id="getmarks-symbolinfo-from-to-ondatacallback-resolution"><a href="#getmarks-symbolinfo-from-to-ondatacallback-resolution" aria-hidden="true" class="header-anchor">#</a> getMarks(symbolInfo, from, to, onDataCallback, resolution)</h3> <p><em>Optional.</em></p> <ol><li><code>symbolInfo</code>: <a href="Symbology#symbolinfo-structure">SymbolInfo</a> object</li> <li><code>from</code>: unix timestamp (UTC). Leftmost visible bar's time.</li> <li><code>to</code>: unix timestamp (UTC). Rightmost visible bar's time.</li> <li><code>onDataCallback</code>: function(array of <code>mark</code>s)</li> <li><code>resolution</code>: string</li></ol> <p>The Library calls this function to get <a href="Marks-On-Bars">marks</a> for visible bars range.</p> <p>The Library assumes that you will call <code>onDataCallback</code> only once per <code>getMarks</code> call.</p> <p><code>mark</code> is an object that has the following properties:</p> <ul><li><code>id</code>: unique mark ID. It will be passed to a <a href="Widget-Methods#subscribeevent-callback">respective callback</a> when user clicks on a mark</li> <li><code>time</code>: unix time, UTC</li> <li><code>color</code>: <code>red</code> | <code>green</code> | <code>blue</code> | <code>yellow</code> | <code>{ border: '#ff0000', background: '#00ff00' }</code></li> <li><code>text</code>: mark popup text. HTML supported</li> <li><code>label</code>: a letter to be printed on a mark. Single character</li> <li><code>labelFontColor</code>: color of a letter on a mark</li> <li><code>minSize</code>: minimum mark size (diameter, pixels) (default value is <code>5</code>)</li></ul> <p>A few marks per bar are allowed (for now, the maximum is <code>10</code>). Marks outside of the bars are not allowed.</p> <p><strong>Remark</strong>: This function will be called only if you confirmed that your back-end is <a href="#supports_marks">supporting marks</a>.</p> <h3 id="gettimescalemarks-symbolinfo-from-to-ondatacallback-resolution"><a href="#gettimescalemarks-symbolinfo-from-to-ondatacallback-resolution" aria-hidden="true" class="header-anchor">#</a> getTimescaleMarks(symbolInfo, from, to, onDataCallback, resolution)</h3> <p><em>Optional.</em></p> <ol><li><code>symbolInfo</code>: <a href="Symbology#symbolinfo-structure">SymbolInfo</a> object</li> <li><code>from</code>: unix timestamp (UTC). Leftmost visible bar's time.</li> <li><code>to</code>: unix timestamp (UTC). Rightmost visible bar's time.</li> <li><code>onDataCallback</code>: function(array of <code>mark</code>s)</li> <li><code>resolution</code>: string</li></ol> <p>The Library calls this function to get timescale marks for visible bars range.</p> <p>The Library assumes that you will call <code>onDataCallback</code> only once per <code>getTimescaleMarks</code> call.</p> <p><code>mark</code> is an object that has the following properties:</p> <ul><li><code>id</code>: unique mark ID. Will be passed to a <a href="Widget-Methods#subscribeevent-callback">respective callback</a> when user clicks on a mark</li> <li><code>time</code>: unix time, UTC</li> <li><code>color</code>: <code>red</code> | <code>green</code> | <code>blue</code> | <code>yellow</code> | ... | <code>#000000</code></li> <li><code>label</code>: a letter to be printed on a mark. Single character</li> <li><code>tooltip</code>: array of text strings. Each element of the array is a new text line of a tooltip.</li></ul> <p>Only one mark per bar is allowed. Marks outside of the bars are not allowed.</p> <p><strong>Remark</strong>: This function will be called only if you confirmed that your back-end is <a href="#supports_timescale_marks">supporting marks</a>.</p> <h3 id="getservertime-callback"><a href="#getservertime-callback" aria-hidden="true" class="header-anchor">#</a> getServerTime(callback)</h3> <ol><li><code>callback</code>: function(unixTime)</li></ol> <p>This function is called if the configuration flag <code>supports_time</code> is set to <code>true</code> when the Charting Library needs to know the server time.</p> <p>The Charting Library assumes that the callback is called once.</p> <p>The time is provided without milliseconds.</p> <p>It is used to display Countdown on the price scale.</p> <p>Example: <code>1445324591</code>.</p> <h2 id="trading-terminal-specific"><a href="#trading-terminal-specific" aria-hidden="true" class="header-anchor">#</a> <a href="Trading-Terminal">Trading Terminal</a> specific</h2> <h3 id="getquotes-symbols-ondatacallback-onerrorcallback"><a href="#getquotes-symbols-ondatacallback-onerrorcallback" aria-hidden="true" class="header-anchor">#</a> getQuotes(symbols, onDataCallback, onErrorCallback)</h3> <p>💹 <em><a href="Trading-Terminal">Trading Terminal</a> specific.</em></p> <ol><li><code>symbols</code>: array of symbols names</li> <li><code>onDataCallback</code>: function(array of <code>data</code>)
<ol><li><code>data</code>: <a href="Quotes#symbol-quote-data">symbol quote data</a></li></ol></li> <li><code>onErrorCallback</code>: function(reason)</li></ol> <p>This function is called when the Charting Library needs quote data. The charting library assumes that <code>onDataCallback</code> is called once when all the requested data is received.</p> <h3 id="subscribequotes-symbols-fastsymbols-onrealtimecallback-listenerguid"><a href="#subscribequotes-symbols-fastsymbols-onrealtimecallback-listenerguid" aria-hidden="true" class="header-anchor">#</a> subscribeQuotes(symbols, fastSymbols, onRealtimeCallback, listenerGUID)</h3> <p>💹 <em><a href="Trading-Terminal">Trading Terminal</a> specific.</em></p> <ol><li><code>symbols</code>: array of symbols that should be updated rarely (once per minute). These symbols are included in the watchlist but they are not visible at the moment.</li> <li><code>fastSymbols</code>: array of symbols that should be updated frequently (once every 10 seconds or more often)</li> <li><code>onRealtimeCallback</code>: function(array of <code>data</code>)
<ol><li><code>data</code>: <a href="Quotes#symbol-quote-data">symbol quote data</a></li></ol></li> <li><code>listenerGUID</code>: unique identifier of the listener</li></ol> <p>Trading Terminal calls this function when it wants to receive real-time quotes for a symbol.</p> <p>The Charting Library assumes that you will call <code>onRealtimeCallback</code> every time you want to update the quotes.</p> <h3 id="unsubscribequotes-listenerguid"><a href="#unsubscribequotes-listenerguid" aria-hidden="true" class="header-anchor">#</a> unsubscribeQuotes(listenerGUID)</h3> <p>💹 <em><a href="Trading-Terminal">Trading Terminal</a> specific.</em></p> <ol><li><code>listenerGUID</code>: unique identifier of the listener</li></ol> <p>Trading Terminal calls this function when it doesn't want to receive updates for this listener anymore.</p> <p><code>listenerGUID</code> will be the same object that the Library passed to <code>subscribeQuotes</code> before.</p> <h3 id="subscribedepth-symbolinfo-callback-string"><a href="#subscribedepth-symbolinfo-callback-string" aria-hidden="true" class="header-anchor">#</a> subscribeDepth(symbolInfo, callback): string</h3> <p>💹 <em><a href="Trading-Terminal">Trading Terminal</a> specific.</em></p> <ol><li><code>symbolInfo</code>: <a href="Symbology#symbolinfo-structure">SymbolInfo</a> object</li> <li><code>callback</code>: function(depth)
<ol><li><code>depth</code>: object <code>{snapshot, asks, bids}</code> <ul><li><code>snapshot</code>: Boolean - if <code>true</code> <code>asks</code> and <code>bids</code> have full set of depth, otherwise they contain only updated levels.</li> <li><code>asks</code>: Array of <code>{price, volume}</code></li> <li><code>bids</code>: Array of <code>{price, volume}</code></li></ul></li></ol></li></ol> <p>Trading Terminal calls this function when it wants to receive real-time level 2 (DOM) for a symbol. The Charting Library assumes that you will call the <code>callback</code> every time you want to update DOM data.</p> <p>This method should return a unique identifier (<code>subscriberUID</code>) that will be used to unsubscribe from the data.</p> <h3 id="unsubscribedepth-subscriberuid"><a href="#unsubscribedepth-subscriberuid" aria-hidden="true" class="header-anchor">#</a> unsubscribeDepth(subscriberUID)</h3> <p>💹 <em><a href="Trading-Terminal">Trading Terminal</a> specific.</em></p> <ol><li><code>subscriberUID</code>: String</li></ol> <p>Trading Terminal calls this function when it doesn't want to receive updates for this listener anymore.</p> <p><code>subscriberUID</code> will be the same object that was returned from <code>subscribeDepth</code>.</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2018-9-6 21:23:09</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/charting_library_wiki/zh/wiki/How-To-Connect-My-Data.html" class="prev">
          如何连接我的数据
        </a></span> <span class="next"><a href="/charting_library_wiki/zh/wiki/UDF.html">
          UDF
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/charting_library_wiki/assets/js/63.ff9aea40.js" defer></script><script src="/charting_library_wiki/assets/js/app.e5b750fa.js" defer></script>
  </body>
</html>
